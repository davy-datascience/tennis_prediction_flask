{% extends 'tennis/base.html' %}

{% block title %}Tennis matches{% endblock %}

{% block content %}
    {% if match_results != None %}

        <h4>Tennis matches</h4>

        <br/>

        <input id="datepicker" data-provide="datepicker">

        <br/><br/>

        <div id="matches_section">
            {% include 'tennis/matches.html' %}
        </div>

        <script>
            (function() {
                // Remove today date from url
                history.replaceState(null, null, location.href.replace(/[\?&]date=[^&]+/, '').replace(/^&/, '?'))

                $('#datepicker').datepicker(
                {
                    format: "dd/mm/yyyy",
                    autoclose: true
                });

                $('#datepicker').datepicker('setDate', new Date());

                $('#datepicker').datepicker().on('changeDate', function(e) {
                    date_picked = $('#datepicker').datepicker('getDate');
                    year = date_picked.getUTCFullYear();
                    month = date_picked.getUTCMonth() + 1;
                    day = date_picked.getUTCDate();
                    hours = date_picked.getUTCHours();
                    minutes = date_picked.getUTCMinutes();

                    date_str = year + "-" + month + "-" + day + "-" + hours + "-" + minutes;

                    fetch('/change_date_of_matches', {
                        headers: {
                          'Content-Type': 'application/json'
                        },
                        method: 'POST',
                        body: date_str
                    }).then(function (response) {
                        return response.text();
                    }).then(function (text) {
                        $("#matches_section").html(text);
                    });

                });
            })();
        </script>

    {% else %}
        <script>
            // Get local datetime and send to server to refresh the page with today's matches at local timezone
            (function() {
                today_at_start = new Date();
                today_at_start.setHours(0,0,0,0);

                year = today_at_start.getUTCFullYear();
                month = today_at_start.getUTCMonth() + 1;
                day = today_at_start.getUTCDate();
                hours = today_at_start.getUTCHours();
                minutes = today_at_start.getUTCMinutes();

                date_str = year + "-" + month + "-" + day + "-" + hours + "-" + minutes;

                window.location.href = "{{ url_for('tennis') }}?date=" + date_str;
            })();
        </script>
    {% endif %}
{% endblock %}